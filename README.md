# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Типы данных, используемые в приложении

Данные о товаре, которые приходят с сервера:

- category: string - категория товара;
- id: string - Id товара;
- description: string - описание товара;
- image: string - изображение товара;
- title: string - название товара;
- price: number | null - цена товара (может быть числом либо null для бесценного товара);
- inBasket?: boolean - булевое значение, показывает наличие/отсутствие товара в корзине;

Тип оплаты:

- TPaymentMethod = "online" | "offline" - вариант оплаты товара;

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой данных, отвечает за хранение и изменение данных
- слой представления, отвечает за отображение данных на странице,
- презентер, отвечает за связь представления и данных.

Презентор не будет выделен в отдельный класс, а будет реализовываться в основном скрипте index.ts

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.\

Методы:

- get - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- post - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
- handleResponse - принимает от сервера и в зависимости от успешности выполнения запроса возвращает ответ с промисом либо ошибкую

#### Класс EventEmitter

Представляет собой брокер событий.\
Уведомляет о создании событий и подписывается на них.

Методы:

- on — устанавливает обработчки для события.
- off - снимает обработчки с события.
- emit - инициирует событие с данными.
- onAll - включает подписки на все события.
- offAll — выключает подписки на все события.
- trigger - возвращает функцию, генерирующую событие при вызове.

#### Класс Component

Осуществляет управление DOM-элементами.

Конструктор принимает контейнер (HTMLElement), куда будет встраиваться компонент.

Методы:

- toggleClass(element: HTMLElement, className: string, force?: boolean) - переключает CSS класс для элемента.
- setText(element: HTMLElement, value: unknown) - устанавливает текстовое содержимое.
- setDisabled(element: HTMLElement, state: boolean) - делает элемент не активным.
- setHidden(element: HTMLElement) - скрывает элемент.
- setVisible(element: HTMLElement) - показывает элемент.
- setImage(element: HTMLImageElement, src: string, alt?: string) - устанавливает алтернативное описание для изображения.
- render(data?: Partial): HTMLElement - возвращает корневой DOM-элемент.


### Слой коммуникации

#### Класс LarekApi

Наследуется от базового класс Api.\
Предоставляет методы для взаимодействия с бэкендом для получения данных товаров, а так же отправки заказа пользователя.

Конструктор принимает:

- baseUrl - базовый URL-адрес приложения.
- cdn - URL CDN, используемый для загрузки изображений товаров.
- options - объект, содержащий дополнительные параметры конфигурации.

Методы:

- getProducts() - отправляет GET запрос для получения данных о товаре.
- addOrder(data) - в качестве параметра принимает объект данных о заказе пользователя и отправляет POST запрос на сервер.

### Слой работы с данными

#### Класс PageData

Класс предназначен для работы с данными всего приложения.\
Обеспечивает функционал для каталога товаров, корзины и заказа пользователя.

Поля класса:

- \_items - массив для хранения товаров.
- _basket - массив для хранения товаров, добавленных в корзину.

Конструктор инициализирует объект events.

Методы:

- set items - сеттер принимает в качестве параметр массив типа IProduct и сохраняет его в поле \_items.
- get items - геттер возвращает сохраненный массив товаров из поля \_items.
- getItem(id: string) - принимает параметр Id товара и возвращает данные об еденице товара.
- addToBasket(item: IProduct) - в качестве параметра принимает продукт и добавляет его в массив корзины.
-  removeFromBasket(item: IProduct) -  в качестве параметра принимает продукт и удаляет его из корзины.
- getTotalBasketPrice() - возвращает общую стоимость товаров из корзины.
- get basket() -возвращает содержимое корзины.

### Слой отображения

#### Класс PageView

Предназначен для отображения элементов на главной странице.

Поля класса:
- productContainer - контейнер для вывода каталога карточек.
- asketIcon - иконка корзины на главной странице.
- basketCounter - элемент для вывода кол-ва товаров, добавленных в корзину.

Конструктор инициализирует поля класса.\
На иконку корзины вешается слушатель для генерации по клику события 'basket:open'.

Методы:
- set gallery(items: HTMLElement[]) - устанавливает содержимое контейнера.
- set counter(value: number) - устанавливает содержимое счетчика для корзины.

#### Класс CardView

Родительский класс для вывода данных о товаре в разных формах.\
Наследуется от базового класса Component.

Поля класса:

- productTitle - элемент разметки для отображения навзания продукта;
- productPrice - элемент разметки для отображения цены продукта;
- productId - Id товара;
- productCategory - элемент разметки для отображения категории продукта;
- productImage - элемент разметки для отображения фото продукта;
- productDescription - элемент разметки для отображения описания продукта;
- cardButton - элемент разметки кнопки в карточке товара;
- productIndex - элемент разметки для отображения нумерации продукта;

Конструктор в качестве параметров принимает элемент разметки будущего контейнера для вывода данных и объект для событий.\
Инициализирует поля класса productTitle и productPrice, которые являются общими для всех форм отображения данных о товаре, а так же объект events.\

В классе создан объект CategoryСolor для отображения категории товара, где ключ это название категории, а значение - CSS класс, который соответствует этому названию.

Методы класса:

- set category - сеттер для установки текста категории товара, а также определения CSS класса для этой категории, которая выступает параметром сеттера.
- set title - сеттер принимает параметр типа string и устанавливает название товара.
- set image - сеттер принимает параметр типа string и устанавливает изображение товара.
- set price - сеттер принимает параметр типа number или null и устанавливает цену товара. В зависимости от параметра (number или null) устанавливает текст для отображения ("кол-во синапсов" или "Бесценно"), а так же переключает состояние кнопки "Оформить" на активно/неактивно.
- set id/get id - сеттер/геттер для сохранения/работы с Id товара, сеттер принимает параметр типа string, геттер возвращает Id товара.
- set index - сеттер принимает параметр типа number и устанавливает порядковый номер товара.
- set index(index: number) - сеттер вкачесвте текста для элемента устанавливает индекс для порядкового номера товара в корзине.
- deleteProduct() - удаляет контейнер.

#### Класс CardGallery

Предназначен для отоброжения данных о продукте в галлерее товаров на главной странице.\ Наследуется от класса CardView.

Конструктор в качестве параметров принимает элемент разметки будущего контейнера для вывода данных и объект для событий.\

Инициализирует поля productCategory, productImage.\
На контейнер(карточку) устаниваливает слушатель для клика по карточке, который генерирует событие 'card:open'и передаёт объект со свойством Id продукта.

#### Класс cardPreview

Предназначен для отоброжения данных о продукте в модальном окне информации о товаре.\ Наследуется от класса CardView.

Конструктор в качестве параметров принимает элемент разметки будущего контейнера для вывода данных и объект для событий.\

Инициализирует поля productCategory, productImage, productDescription, cardButton.\
На кнопку карточки вешает слушатель для генерации события 'basket:change'.

#### Класс СardInBasket

Предназначен для отоброжения данных о продукте в модальном окне корзины с товарами.\ Наследуется от класса CardView.

Конструктор в качестве параметров принимает элемент разметки будущего контейнера для вывода данных и объект для событий.\
Инициализирует поля productIndex, cardButton.
На кнопку карточки вешает слушатель для генерации события 'basket:remove'.

#### Класс BasketView

Класс предназначен для отображения корзины товаров.\
Наследуется от базового класса Component.

Поля класса:

- basketList - элемент разметки для отображения списка товаров в корзине.
- basketOrderButton - элемент разметки для отображения кнопки оформления заказа в корзине.
- basketTotalPrice - элемент разметки для отображения итоговой стоимости товаров в корзине.

Конструктор:

Инициализирует поля класса.\
На конопку карточкт устанавливает слушательдля генерации события 'order:open'.

Методы:

- set totalPrice(value: number) - устанавливает цену товара.
- set items(items: HTMLElement[]) - в завимиости от наличия товаров в корзине выводит их данные в список либо, при их отсутствии, создаёт элемент с уведомлением о том, что корзина пуста.


#### Класс ModalView

Класс предназанчен для работы с модальными окнами.\
Наследуется от базового класса Component.\

Поля класса:

- closeButton - кнопка для закрытия модального окна;
- \_content - область содержимого модального окна;
- wrapper - элемент разметки контейнера для контента всей страницы;

Конструктор в качестве параметров принимает элемент разметки будущего контейнера для вывода данных и объект для событий.\
Инициализирует поля класса.\
На контейнер добавляет обработчки события - при нажатии на оверлей, модальное окно закрывается.\
На кнопку для закрытя добавляет обработчик закрытие модального окна по клику.\
На контент добавляет обработчик отмены всплытия.

Методы:

- set content(value: HTMLElement) - принимает в качестве параметра HTMLElement(темплейт) и устанавливает его как содержимое модального окна.
- open() - открывает модальное окно, генерирует событие "modal:open" и добавляет на страницу обработчик закрытия модального окна при нажатии клавиши "Escape".\
  Вешает класс '.page\_\_wrapper_locked' на враппер страницы для фиксированного положения.
- close() - открывает модальное окно, генерирует событие "modal:closed", снимает с документа обработчик закрытия модального окна при нажатии клавиши "Escape".\
  Снимает класс '.page\_\_wrapper_locked' с враппера страницы.
- handleEscUp (evt: KeyboardEvent) - закрытие модального окна кливашей Escape.
- render(data: IModalData) - рендерит модальное окно с установленным контентом и открывает его методом open().

События:

- items:changed -
- card:open -
- modal:open -
- modal:closed -
- order:open -
