# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Типы данных, используемые в приложении

Данные о товаре, которые приходят с сервера:

- category: string - категория товара;
- id: string - Id товара;
- description: string - описание товара;
- image: string - изображение товара;
- title: string - название товара;
- price: number | null - цена товара (может быть числом либо null для бесценного товара);

Тип оплаты

- TPaymentMethod = "online" | "offline" - вариант оплаты товара;

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой данных, отвечает за хранение и изменение данных
- слой представления, отвечает за отображение данных на странице,
- презентер, отвечает за связь представления и данных.

Презентор не будет выделен в отдельный класс, а будет реализовываться в основном скрипте index.ts

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. Методы:

- get - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- post - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом IEvents:

- on - подписка на событие
- emit - инициализация события
- trigger - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой коммуникации

#### Класс LarekApi

Наследуется от базового класс Api. Предоставляет методы для взаимодействия с бэкендом для получения данных товаров, а так же отправки заказа пользователя.

Конструктор принимает:

- baseUrl - базовый URL-адрес приложения.
- cdn - URL CDN, используемый для загрузки изображений товаров.
- options - объект, содержащий дополнительные параметры конфигурации.

Методы:

- getProducts() - отправляет GET запрос для получения данных о товаре.
- addOrder(data) - в качестве параметра принимает объект данных о заказе пользователя и отправляет POST запрос на сервер.

### Слой работы с данными

#### Класс ProductsData

Класс, предоставляющий методы для взаимодействия с коллекцией продуктов и отправки событий при изменении коллекции.

Свойства:

- \_items - массив IProduct объектов.
- events - объект для управления событиями при изменении даннных.

Конструктор инициализирует объект events.

Методы:

- getItem(id: string) - возвращает данные об еденице товара по его id.
- set/get items - сеттер/геттер для хранения и работы с массивом товаров.

### Слой отображения

#### Класс CardView

Родительский класс для вывода данных о товаре в разных формах.\
Наследуется от базового класса Component.

Поля класса:

- productTitle - элемент разметки для отображения навзания продукта;
- productPrice - элемент разметки для отображения цены продукта;
- productId - Id товара;
- productCategory - элемент разметки для отображения категории продукта;
- productImage - элемент разметки для отображения фото продукта;
- productDescription - элемент разметки для отображения описания продукта;
- basketButton - элемент разметки кнопки в карточке товара;
- productIndex - элемент разметки для отображения нумерации продукта;

Конструктор в качестве параметров принимает элемент разметки будущего контейнера для вывода данных и объект для событий.\
Инициализирует поля класса productTitle и productPrice, которые являются общими для всех форм отображения данных о товаре, а так же объект events.\

В классе создан объект CategoryСolor для отображения категории товара, где ключ это название категории, а значение - CSS класс, который соответствует этому названию.

Методы класса:

- set category - сеттер для установки текста категории товара, а также определения CSS класса для этой категории, которая выступает параметром сеттера;
- set title - сеттер принимает в качестве параметра и устанавливает название товара;
- set image - сеттер принимает в качестве параметра и устанавливает изображение товара;
- set price - сеттер принимает в качестве параметра и устанавливает изображение товара;
- set price - сеттер принимает в качестве параметра и устанавливает цену товара. В зависимости от параметра (число или null) устанавливает текст для отображения ("кол-во синапсов" или "Бесценно");
- set id/get id - сеттер/геттер для сохранения/работы с Id товара;
- set index - сеттер принимает в качестве параметра и устанавливает порядковый номер товара;

#### Класс CardGallery

Предназначен для отоброжения данных о продукте в галлерее товаров на главной странице.\ Наследуется от класса CardView.

Конструктор в качестве параметров принимает элемент разметки будущего контейнера для вывода данных и объект для событий.\

Инициализирует поля productCategory, productImage.\
На контейнер(карточку) устаниваливает слушатель для клика по карточке, который генерирует событие 'card:open'и передаёт объект со свойством Id продукта.

#### Класс cardPreview

Предназначен для отоброжения данных о продукте в модальном окне информации о товаре.\ Наследуется от класса CardView.

Конструктор в качестве параметров принимает элемент разметки будущего контейнера для вывода данных и объект для событий.\

Инициализирует поля productCategory, productImage, productDescription, basketButton.

#### Класс cardBasket

Предназначен для отоброжения данных о продукте в модальном окне корзины с товарами.\ Наследуется от класса CardView.

Конструктор в качестве параметров принимает элемент разметки будущего контейнера для вывода данных и объект для событий.\

Инициализирует поля productIndex, basketButton.

#### Класс ModalView

Класс предназанчен для работы с модальными окнами.\ Наследуется от базового класса Component.\

Поля класса:

- closeButton - кнопка для закрытия модального окна.
- \_content - область содержимого модального окна.
- events - объект для управления событиями при изменении даннных.

Контсруктор инициализирует поля класса.

Методы:

- set content(value: HTMLElement) - принимает в качестве параметра HTMLElement и устанавливает его как содержимое модального окна.
- open() - открывает модальное окно, генерирует событие "modal:open" и добавляет на страницу обработчик закрытия модального окна при нажатии клавиши "Escape".
- close() - открывает модальное окно, генерирует событие "modal:closed", снимает с документа обработчик закрытия модального окна при нажатии клавиши "Escape".
- handleEscUp (evt: KeyboardEvent) - закрытие модального окна кливашей Escape.
- render(data: IModalData) - рендерит модальное окно с установленным контентом и открывает его методом open().
